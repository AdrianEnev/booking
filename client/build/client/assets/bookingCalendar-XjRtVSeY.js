import{w as z}from"./with-props-Bh_-DjLQ.js";import{o as e,a as h,p as E}from"./chunk-AYJ5UCUI-DsV8cjzK.js";import{u as T}from"./GlobalContext-BODhfs1P.js";import{s as D}from"./useStandardizeDate-DE6U8t9S.js";import{m as j}from"./proxy-BNWwsI7H.js";import{S as B,N as H,f as L,A as P,g as y,h as q}from"./getDimensions-DfCmOIKW.js";import{f as J}from"./useFetchAppointments-DsUODtBA.js";const G=({index:t,day:r})=>e.jsx("div",{className:`flex items-center justify-center h-full 
                text-black font-medium w-1/7 text-sm sm:text-base
                ${t==1?"border-r border-gray-100":t==7?"border-l border-gray-100":"border-x border-gray-100"}
            `,children:r},t);function U({index:t,day:r,numberOfDays:a,selectedDate:s,setSelectedDate:o,setInitialDateSelected:n,bookedDays:d}){return e.jsx("button",{className:`flex py-2 px-3 text-sm md:text-base
                text-black font-medium ${a>35?"h-1/6":"h-1/5"} w-1/7 
                border border-gray-100 
                ${t==29?"rounded-bl-xl":t>=1&&t<=7?"rounded-x-xl":""}
                ${d.includes(r)?"bg-red-400 cursor-not-allowed":"hover:bg-gray-50 transition-colors duration-200 cursor-pointer"}
            `,onClick:()=>{n(!0);const c=new Date(s.getFullYear(),s.getMonth(),r);o(c)},children:r},t)}const V=t=>{const r=t.getMonth(),a=t.getFullYear(),s=new Date(a,r+1,0).getDate(),o=[];for(let n=1;n<=s;n++)o.push(n);return o};function W({selectedDate:t,setSelectedDate:r,setInitialDateSelected:a,navigate:s,bookedDays:o}){const n=["Пон","Вто","Сря","Чет","Пет","Съб","Нед"],d=V(t),c=l=>{const i={month:"long",year:"numeric"};return l.toLocaleDateString("bg-BG",i).replace(" г.","").replace(/^./,b=>b.toUpperCase())},m=l=>{const i=new Date,p=new Date(i.getFullYear(),i.getMonth()+3,1);if(l.getFullYear()<p.getFullYear()||l.getFullYear()===p.getFullYear()&&l.getMonth()<p.getMonth()){const b=new Date(l);b.setMonth(b.getMonth()+1),r(b)}},u=l=>{const i=new Date;if(l.getFullYear()>i.getFullYear()||l.getFullYear()===i.getFullYear()&&l.getMonth()>i.getMonth()){const p=new Date(l);p.setMonth(p.getMonth()-1),r(p)}},g=(new Date(t.getFullYear(),t.getMonth(),1).getDay()+6)%7,f=g+d.length;return e.jsxs("div",{className:"w-full h-[55%] md:h-[95%] bg-white rounded-xl shadow-lg border border-gray-300 font-manrope",children:[e.jsx("div",{className:"w-full h-[16%] md:h-[8%] bg-[#f8f8f8] rounded-x-xl rounded-t-xl border-b border-gray-300",children:e.jsxs("div",{className:"flex w-full h-full items-center justify-between pr-3 md:pr-6",children:[e.jsxs("div",{className:"flex flex-row items-center h-full w-[80%] gap-x-2 sm:gap-x-4 md:gap-x-6",children:[e.jsx("button",{className:`w-16 h-full mt-[-4px] border-r border-gray-300
                            hover:opacity-40 transition-colors duration-200 cursor-pointer
                        `,onClick:()=>{s("/")},children:e.jsx("p",{className:"text-4xl text-[#4a6fa5]",children:"<"})}),e.jsx("p",{className:"text-sm 3xs:text-base md:text-lg lg:text-2xl font-semibold text-[#403f3f] w-1/2",children:c(t)})]}),e.jsx("div",{className:"flex flex-row gap-x-5 w-[30%] sm:w-[20%] md:w-[15%] h-[65%] sm:h-[55%] md:h-[50%]",children:e.jsxs("div",{className:"flex flex-row items-center justify-between w-full h-full bg-white shadow-md rounded-lg border border-gray-300 text-black",children:[e.jsx("button",{className:"w-1/4 h-full rounded-l-lg rounded-y-lg hover:bg-gray-200 active:opacity-40",onClick:()=>u(t),children:e.jsx("p",{className:"text-[#4a6fa5]",children:"<"})}),e.jsx("p",{className:"text-sm md:text-base font-medium",children:"Месец"}),e.jsx("button",{className:"w-1/4 h-full rounded-r-lg rounded-y-lg hover:bg-gray-200 active:opacity-40",onClick:()=>m(t),children:e.jsx("p",{className:"text-[#4a6fa5]",children:">"})})]})})]})}),e.jsx("div",{className:"w-full h-[12%] md:h-[6%] bg-white rounded-x-xl border-b border-gray-300 flex flex-row justify-between",children:n.map((l,i)=>e.jsx(G,{index:i+1,day:l},i))}),e.jsxs("div",{className:"w-full h-[86%] bg-white rounded-x-xl rounded-b-xl flex flex-row flex-wrap",children:[Array.from({length:g}).map((l,i)=>e.jsx("div",{className:`${f>35?"h-1/6":"h-1/5"} w-1/7  bg-[#f8f8f8]`},`empty-${i}`)),d.map((l,i)=>e.jsx(U,{index:i+1,day:l,numberOfDays:f,selectedDate:t,setSelectedDate:r,setInitialDateSelected:a,bookedDays:o},i))]})]})}const Z=async(t,r)=>{const s=new Date(t.getTime()-t.getTimezoneOffset()*6e4).toISOString().split("T")[0];try{const o=await fetch("https://booking-app.fly.dev/api/booking/available-hours",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:s,bookedHours:r})});return o.ok?await o.json():(console.error("Response ERROR retreiving available hours:",o),null)}catch(o){return console.error("ERROR retreiving available hours:",o),null}},K=async(t,r,a,s,o)=>{if(!r){if(o.length===0){s(["15:00","15:30","16:00","16:30","17:00","17:30","18:00","18:30","19:00","19:30","20:00","20:30","21:00","21:30"]);return}a(!0),await Q(t,s,o),a(!1)}},Q=async(t,r,a)=>{if(X(t,a))console.log("Date is fully booked"),r([]);else{const o=await ee(t,a),n=await Z(t,o);r(n)}},X=(t,r)=>{const a=S(t),s=r.filter(o=>k(new Date(o.appointmentDate),a));return te(a)?s.length===8:s.length===12},ee=async(t,r)=>{const a=S(t),s=[];return r.forEach(o=>{k(new Date(o.appointmentDate),a)&&s.push(o.hour)}),s};function k(t,r){return t.getFullYear()===r.getFullYear()&&t.getMonth()===r.getMonth()&&t.getDate()===r.getDate()}const S=t=>{const r=new Date(t);return r.setHours(23,59,59,999),r},te=t=>{const r=t.getDay();return r===0||r===6};function re({index:t,hour:r,numberOfHours:a,setSelectedHour:s}){return e.jsx("button",{className:`flex py-2 px-3
                text-black text-lg font-medium ${a<=9?"w-1/4 md:w-1/5":"w-1/6 md:w-1/7"} 
                border border-gray-100 items-center justify-center
                bg-white hover:bg-gray-50 transition-colors duration-200 cursor-pointer
            `,onClick:()=>{s(r)},children:r},t)}function ae({selectedDate:t,setInitialDateSelected:r,availableHours:a,setSelectedHour:s,customCalendarHoursAnimationRan:o,setCustomCalendarHoursAnimationRan:n}){return e.jsxs(j.div,{className:"w-full h-[60%] md:h-[95%] bg-white rounded-xl shadow-lg border border-gray-300 font-manrope",initial:o?{}:{scale:.5},animate:{scale:1},transition:{duration:.3},onAnimationComplete:()=>{!o&&n&&n(!0)},children:[e.jsxs("div",{className:"w-full h-[16%] md:h-[8%] bg-[#f8f8f8] rounded-x-xl rounded-t-xl border-b border-gray-300 flex flex-row items-center gap-x-6",children:[e.jsx("button",{className:`w-16 h-full border-r border-gray-300 mt-[-4px]
                hover:opacity-40 transition-colors duration-200 cursor-pointer
            `,onClick:()=>{r(!1),n(!1)},children:e.jsx("p",{className:"text-4xl text-[#4a6fa5]",children:"<"})}),e.jsx("p",{className:"text-lg md:text-2xl font-semibold text-[#403f3f] w-1/2",children:D(t)})]}),e.jsx("div",{className:"w-full h-[92%] bg-white rounded-x-xl rounded-b-xl flex flex-row flex-wrap",children:a.map((d,c)=>e.jsx(re,{index:c+1,hour:d,numberOfHours:a.length,setSelectedHour:s},c))})]})}const oe=async()=>{const t=localStorage.getItem("bookedAppointments");return t?JSON.parse(t):[]},se=({setSelectedService:t,dimensions:r})=>{const a=({title:s,price:o,src:n})=>e.jsxs("button",{className:"flex flex-col hover:opacity-70 transition-colors duration-200 cursor-pointer",onClick:()=>t(s),children:[e.jsx("img",{src:n,alt:"Slide 1",className:"w-auto h-auto rounded-t-xl"}),e.jsxs("div",{className:"w-full h-16 bg-[#f8f8f8] shadow-lg border border-gray-200 rounded-b-xl flex items-center justify-between px-6",children:[e.jsx("p",{className:"text-xl md:text-2xl font-medium text-[#3a5e94]",children:s}),e.jsxs("p",{className:"text-xl md:text-2xl font-semibold text-[#3a5e94]",children:[o,"лв"]})]})]});return e.jsx("div",{className:"w-[90%] h-full flex items-center",children:e.jsxs(B,{modules:[H,L,P],slidesPerView:((r==null?void 0:r.width)??0)>768?2:1,slidesPerGroup:((r==null?void 0:r.width)??0)>768?2:1,navigation:!0,loop:!0,pagination:{clickable:!1},spaceBetween:32,children:[e.jsx(y,{children:e.jsx(a,{title:"Къса прическа",price:10,src:"/images/short_hair_square.jpg"})}),e.jsx(y,{children:e.jsx(a,{title:"Дълга прическа",price:15,src:"/images/design_studio_square.jpg"})}),e.jsx(y,{children:e.jsx(a,{title:"Услуга 1",price:5,src:"/images/short_hair_burst_fade_cropped.jpg"})}),e.jsx(y,{children:e.jsx(a,{title:"Услуга 2",price:12.5,src:"/images/short_hair_burst_fade_design_cropped.jpg"})})]})})};function ne({selectedDate:t,selectedHour:r,setSelectedHour:a,setSelectedService:s,dimensions:o,customCalendarServicesAnimationRan:n,setCustomCalendarServicesAnimationRan:d}){return e.jsxs(j.div,{className:"w-full h-[95%] bg-white rounded-xl shadow-lg border border-gray-300 font-manrope",initial:n?{}:{scale:.5},animate:{scale:1},transition:{duration:.3},onAnimationComplete:()=>{!n&&d&&d(!0)},children:[e.jsxs("div",{className:"w-full h-[8%] bg-[#f8f8f8] rounded-x-xl rounded-t-xl border-b border-gray-300 flex flex-row items-center gap-x-6",children:[e.jsx("button",{className:`w-16 h-full border-r border-gray-300 mt-[-4px]
                    hover:opacity-40 transition-colors duration-200 cursor-pointer
                `,onClick:()=>{a(""),d(!1)},children:e.jsx("p",{className:"text-4xl text-[#4a6fa5]",children:"<"})}),e.jsxs("div",{className:"flex flex-row w-full md:w-1/2 h-full items-center gap-x-3",children:[e.jsx("p",{className:"text-sm 3xs:text-base md:text-2xl font-semibold text-[#403f3f] min-w-1/2 border-r border-gray-300",children:D(t)}),e.jsx("p",{className:"text-sm 3xs:text-base md:text-2xl font-semibold text-[#403f3f] min-w-1/2",children:r})]})]}),e.jsx("div",{className:"w-full h-[92%] flex justify-center",children:e.jsx(se,{setSelectedService:s,dimensions:o})})]})}const le=async(t,r,a)=>{if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t))return alert("Please enter a valid email address."),!1;if(!/^(?:\+359|0)(?:8[7-9])[0-9]{7}$/.test(r))return alert("Please enter a valid phone number."),!1;if(!/^[a-zA-Zа-яА-ЯёЁ\s]+$/.test(a))return alert("Please enter a valid name. (Example: Адриан Енев)"),!1},ie=async(t,r,a,s,o,n,d,c,m,u)=>{let x=!1;u&&(x=!0);try{const g=await fetch("https://booking-app.fly.dev/api/booking",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerName:t,customerPhone:r,customerEmail:a,service:s,date:o,hour:n,note:d,appointmentVerified:x})});if(!g.ok)return console.error("Response error booking appointment:",g),c(!1),null;const f=await J();f&&localStorage.setItem("bookedAppointments",JSON.stringify(f));const l=await g.json();if(l.message=="hour-already-booked"){if(u){alert("Този час вече е зает!"),m("/admin/dashboard");return}m("/booking"),alert(`Този час бе зает от някой друг, току що! (${n})`);return}if(l.message=="email-already-used"){if(u){alert("Този имейл вече е използван!");return}m("/"),alert("Вече имаш запазен час!");return}if(l.message=="error-creating-appointment"){if(u){alert("Възникна грешка!"),m("/admin/dashboard");return}m("/"),alert("Грешка! Опитай отново по-късно!");return}if(alert("Записването е успешно!"),u){m("/admin/dashboard");return}m("/")}catch(g){return console.error("Error booking appointment:",g),c(!1),null}},de=async(t,r,a,s,o,n,d,c,m,u,x)=>{t||!a||!s||!o||!n||!d||!c||await le(c,d,n)!=!1&&(r(!0),await ie(n,d,c,a,s,o,m,r,u,x),r(!1))};function ce({selectedDate:t,selectedHour:r,selectedService:a,setSelectedService:s,loading:o,setLoading:n,navigate:d,isAdmin:c,customCalendarCheckoutAnimationRan:m,setCustomCalendarCheckoutAnimationRan:u}){const[x,g]=h.useState({email:"",name:"",phone:"",additionalInfo:""}),f=i=>{const{name:p,value:b}=i.target;g({...x,[p]:b})},l=async i=>{i.preventDefault();const b=new Date(t.getTime()-t.getTimezoneOffset()*6e4).toISOString().split("T")[0];await de(o,n,a,b,r,x.name,x.phone,x.email,x.additionalInfo,d,c)};return e.jsxs(j.div,{className:"w-full h-[93%] bg-white rounded-xl shadow-lg border border-gray-300 font-manrope",initial:m?{}:{scale:.5},animate:{scale:1},transition:{duration:.3},onAnimationComplete:()=>{!m&&u&&u(!0)},children:[e.jsxs("div",{className:"w-full h-[8%] bg-[#f8f8f8] rounded-x-xl rounded-t-xl border-b border-gray-300 flex flex-row items-center gap-x-6",children:[e.jsx("button",{className:`w-16 h-full border-r border-gray-300 mt-[-4px]
                    hover:opacity-40 transition-colors duration-200 cursor-pointer
                `,onClick:()=>{s(""),u(!1)},children:e.jsx("p",{className:"text-4xl text-[#4a6fa5]",children:"<"})}),e.jsxs("div",{className:"flex flex-row w-full md:w-1/2 h-full items-center gap-x-3",children:[e.jsx("p",{className:"text-sm 3xs:text-base md:text-2xl font-semibold text-[#403f3f] min-w-1/2 border-r border-gray-300",children:D(t)}),e.jsx("p",{className:"text-sm 3xs:text-base md:text-2xl font-semibold text-[#403f3f] min-w-1/2",children:r})]})]}),e.jsxs("div",{className:"max-w-2xl mx-auto px-6 pt-[10%] md:py-6 md:px-6 h-[80%] flex flex-col items-center md:justify-center",children:[e.jsx("p",{className:"text-xl md:text-2xl font-semibold text-[#403f3f] w-full mb-3 text-center",children:a}),e.jsxs("form",{className:"grid grid-cols-1 gap-4 w-full",onSubmit:l,children:[e.jsx("input",{name:"email",placeholder:"Имейл",className:"w-full p-3 border border-gray-300 shadow-sm rounded-xl text-black",value:x.email,onChange:f,maxLength:40,required:!0}),e.jsx("input",{name:"name",placeholder:"Име",className:"w-full p-3 border border-gray-300 shadow-sm rounded-xl text-black",value:x.name,onChange:f,maxLength:30,required:!0}),e.jsx("input",{name:"phone",placeholder:"Телефонен номер",className:"w-full p-3 border border-gray-300 shadow-sm rounded-xl text-black",value:x.phone,onChange:f,maxLength:10,required:!0}),e.jsx("input",{name:"additionalInfo",placeholder:"Допълнителна информация",className:"w-full p-3 border border-gray-300 shadow-sm rounded-xl text-black",value:x.additionalInfo,maxLength:50,onChange:f}),e.jsx("button",{type:"submit",className:`bg-[#567bb1] text-white text-lg font-medium shadow-sm p-3 rounded-xl
                        
                        hover:opacity-80 transition-colors duration-200`,children:"Запиши ме"})]})]})]})}const xe=async()=>{const t=localStorage.getItem("bookedDays");return t?JSON.parse(t):[]},fe=()=>{const t=E(),{loading:r,setLoading:a,isAdmin:s}=T(),[o,n]=h.useState(!1),[d,c]=h.useState(!1),[m,u]=h.useState(!1),[x,g]=h.useState(!1),[f,l]=h.useState(new Date),[i,p]=h.useState(""),[b,N]=h.useState(""),[C,M]=h.useState([]),[F,O]=h.useState([]),[$,Y]=h.useState([]),[_,A]=h.useState({width:0,height:0}),v=async()=>{const w=await q();A(w)};return h.useEffect(()=>{const w=()=>{v()};return window.addEventListener("resize",w),v(),()=>{window.removeEventListener("resize",w)}},[]),h.useEffect(()=>{(async()=>{const I=await oe();O(I);const R=await xe();Y(R)})()},[]),h.useEffect(()=>{o&&K(f,r,a,M,F)},[f]),e.jsx(j.div,{className:`w-full h-full font-manrope ${s?"px-10 pt-6":"px-[4%] md:px-[9%] pt-10"}`,initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.3},children:o?o&&!i?e.jsx(ae,{selectedDate:f,setInitialDateSelected:n,availableHours:C,setSelectedHour:p,customCalendarHoursAnimationRan:d,setCustomCalendarHoursAnimationRan:c}):b?e.jsx(ce,{selectedDate:f,selectedHour:i,selectedService:b,setSelectedService:N,loading:r,setLoading:a,navigate:t,isAdmin:s,customCalendarCheckoutAnimationRan:x,setCustomCalendarCheckoutAnimationRan:g}):e.jsx(ne,{selectedDate:f,selectedHour:i,setSelectedHour:p,setSelectedService:N,dimensions:_,customCalendarServicesAnimationRan:m,setCustomCalendarServicesAnimationRan:u}):e.jsx(W,{selectedDate:f,setSelectedDate:l,setInitialDateSelected:n,navigate:t,bookedDays:$})})},ye=z(fe);export{ye as default};
