import{w as Y}from"./with-props-6HJavTuU.js";import{o as e,a as x,p as _}from"./chunk-AYJ5UCUI-Bkv6Ioix.js";import{u as A}from"./GlobalContext-DI10b9EF.js";import{s as j}from"./useStandardizeDate-DE6U8t9S.js";import{S as O,N as I,f as z,A as B,g as y,h as $}from"./getDimensions-BkqnHEUB.js";import{v as E,p as H}from"./usePostAppointment-XMg77Olk.js";import"./useFetchAppointments-DsUODtBA.js";const R=({index:t,day:r})=>e.jsx("div",{className:`flex items-center justify-center h-full 
                text-black font-medium w-1/7 text-sm sm:text-base
                ${t==1?"border-r border-gray-100":t==7?"border-l border-gray-100":"border-x border-gray-100"}
            `,children:r},t);function T({index:t,day:r,numberOfDays:s,selectedDate:a,setSelectedDate:o,setInitialDateSelected:n,bookedDays:d}){return e.jsx("button",{className:`flex py-2 px-3 text-sm md:text-base
                text-black font-medium ${s>35?"h-1/6":"h-1/5"} w-1/7 
                border border-gray-100 
                ${t==29?"rounded-bl-xl":t>=1&&t<=7?"rounded-x-xl":""}
                ${d.includes(r)?"bg-red-400 cursor-not-allowed":"hover:bg-gray-50 transition-colors duration-200 cursor-pointer"}
            `,onClick:()=>{n(!0);const u=new Date(a.getFullYear(),a.getMonth(),r);o(u)},children:r},t)}const L=t=>{const r=t.getMonth(),s=t.getFullYear(),a=new Date(s,r+1,0).getDate(),o=[];for(let n=1;n<=a;n++)o.push(n);return o};function q({selectedDate:t,setSelectedDate:r,setInitialDateSelected:s,navigate:a,bookedDays:o}){const n=["Пон","Вто","Сря","Чет","Пет","Съб","Нед"],d=L(t),u=i=>{const l={month:"long",year:"numeric"};return i.toLocaleDateString("bg-BG",l).replace(" г.","").replace(/^./,b=>b.toUpperCase())},c=i=>{const l=new Date,f=new Date(l.getFullYear(),l.getMonth()+3,1);if(i.getFullYear()<f.getFullYear()||i.getFullYear()===f.getFullYear()&&i.getMonth()<f.getMonth()){const b=new Date(i);b.setMonth(b.getMonth()+1),r(b)}},h=i=>{const l=new Date;if(i.getFullYear()>l.getFullYear()||i.getFullYear()===l.getFullYear()&&i.getMonth()>l.getMonth()){const f=new Date(i);f.setMonth(f.getMonth()-1),r(f)}},p=(new Date(t.getFullYear(),t.getMonth(),1).getDay()+6)%7,g=p+d.length;return e.jsxs("div",{className:"w-full h-[55%] md:h-[95%] bg-white rounded-xl shadow-lg border border-gray-300 font-manrope",children:[e.jsx("div",{className:"w-full h-[16%] md:h-[8%] bg-[#f8f8f8] rounded-x-xl rounded-t-xl border-b border-gray-300",children:e.jsxs("div",{className:"flex w-full h-full items-center justify-between pr-3 md:pr-6",children:[e.jsxs("div",{className:"flex flex-row items-center h-full w-[80%] gap-x-2 sm:gap-x-4 md:gap-x-6",children:[e.jsx("button",{className:`w-16 h-full mt-[-4px] border-r border-gray-300
                            hover:opacity-40 transition-colors duration-200 cursor-pointer
                        `,onClick:()=>{a("/")},children:e.jsx("p",{className:"text-4xl text-[#4a6fa5]",children:"<"})}),e.jsx("p",{className:"text-sm 3xs:text-base md:text-lg lg:text-2xl font-semibold text-[#403f3f] w-1/2",children:u(t)})]}),e.jsx("div",{className:"flex flex-row gap-x-5 w-[30%] sm:w-[20%] md:w-[15%] h-[65%] sm:h-[55%] md:h-[50%]",children:e.jsxs("div",{className:"flex flex-row items-center justify-between w-full h-full bg-white shadow-md rounded-lg border border-gray-300 text-black",children:[e.jsx("button",{className:"w-1/4 h-full rounded-l-lg rounded-y-lg hover:bg-gray-200 active:opacity-40",onClick:()=>h(t),children:e.jsx("p",{className:"text-[#4a6fa5]",children:"<"})}),e.jsx("p",{className:"text-sm md:text-base font-medium",children:"Месец"}),e.jsx("button",{className:"w-1/4 h-full rounded-r-lg rounded-y-lg hover:bg-gray-200 active:opacity-40",onClick:()=>c(t),children:e.jsx("p",{className:"text-[#4a6fa5]",children:">"})})]})})]})}),e.jsx("div",{className:"w-full h-[12%] md:h-[6%] bg-white rounded-x-xl border-b border-gray-300 flex flex-row justify-between",children:n.map((i,l)=>e.jsx(R,{index:l+1,day:i},l))}),e.jsxs("div",{className:"w-full h-[86%] bg-white rounded-x-xl rounded-b-xl flex flex-row flex-wrap",children:[Array.from({length:p}).map((i,l)=>e.jsx("div",{className:`${g>35?"h-1/6":"h-1/5"} w-1/7  bg-[#f8f8f8]`},`empty-${l}`)),d.map((i,l)=>e.jsx(T,{index:l+1,day:i,numberOfDays:g,selectedDate:t,setSelectedDate:r,setInitialDateSelected:s,bookedDays:o},l))]})]})}const G=async(t,r)=>{const a=new Date(t.getTime()-t.getTimezoneOffset()*6e4).toISOString().split("T")[0];try{const o=await fetch("https://booking-app.fly.dev/api/booking/available-hours",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:a,bookedHours:r})});return o.ok?await o.json():(console.error("Response ERROR retreiving available hours:",o),null)}catch(o){return console.error("ERROR retreiving available hours:",o),null}},J=async(t,r,s,a,o)=>{if(!r){if(o.length===0){a(["15:00","15:30","16:00","16:30","17:00","17:30","18:00","18:30","19:00","19:30","20:00","20:30","21:00","21:30"]);return}s(!0),await P(t,a,o),s(!1)}},P=async(t,r,s)=>{if(U(t,s))console.log("Date is fully booked"),r([]);else{const o=await W(t,s),n=await G(t,o);r(n)}},U=(t,r)=>{const s=N(t),a=r.filter(o=>v(new Date(o.appointmentDate),s));return V(s)?a.length===8:a.length===12},W=async(t,r)=>{const s=N(t),a=[];return r.forEach(o=>{v(new Date(o.appointmentDate),s)&&a.push(o.hour)}),a};function v(t,r){return t.getFullYear()===r.getFullYear()&&t.getMonth()===r.getMonth()&&t.getDate()===r.getDate()}const N=t=>{const r=new Date(t);return r.setHours(23,59,59,999),r},V=t=>{const r=t.getDay();return r===0||r===6};function K({index:t,hour:r,numberOfHours:s,setSelectedHour:a}){return e.jsx("button",{className:`flex py-2 px-3
                text-black text-lg font-medium ${s<=9?"w-1/4 md:w-1/5":"w-1/6 md:w-1/7"} 
                border border-gray-100 items-center justify-center
                bg-white hover:bg-gray-50 transition-colors duration-200 cursor-pointer
            `,onClick:()=>{a(r)},children:r},t)}function Q({selectedDate:t,setInitialDateSelected:r,availableHours:s,setSelectedHour:a}){return e.jsxs("div",{className:"w-full h-[60%] md:h-[95%] bg-white rounded-xl shadow-lg border border-gray-300 font-manrope",children:[e.jsxs("div",{className:"w-full h-[16%] md:h-[8%] bg-[#f8f8f8] rounded-x-xl rounded-t-xl border-b border-gray-300 flex flex-row items-center gap-x-6",children:[e.jsx("button",{className:`w-16 h-full border-r border-gray-300 mt-[-4px]
                    hover:opacity-40 transition-colors duration-200 cursor-pointer
                `,onClick:()=>{r(!1)},children:e.jsx("p",{className:"text-4xl text-[#4a6fa5]",children:"<"})}),e.jsx("p",{className:"text-lg md:text-2xl font-semibold text-[#403f3f] w-1/2",children:j(t)})]}),e.jsx("div",{className:"w-full h-[92%] bg-white rounded-x-xl rounded-b-xl flex flex-row flex-wrap",children:s.map((o,n)=>e.jsx(K,{index:n+1,hour:o,numberOfHours:s.length,setSelectedHour:a},n))})]})}const X=async()=>{const t=localStorage.getItem("bookedAppointments");return t?JSON.parse(t):[]},Z=({setSelectedService:t,dimensions:r})=>{const s=({title:a,price:o,src:n})=>e.jsxs("button",{className:"flex flex-col hover:opacity-70 transition-colors duration-200 cursor-pointer",onClick:()=>t(a),children:[e.jsx("img",{src:n,alt:"Slide 1",className:"w-auto h-auto rounded-t-xl"}),e.jsxs("div",{className:"w-full h-16 bg-[#f8f8f8] shadow-lg border border-gray-200 rounded-b-xl flex items-center justify-between px-6",children:[e.jsx("p",{className:"text-xl md:text-2xl font-medium text-[#3a5e94]",children:a}),e.jsxs("p",{className:"text-xl md:text-2xl font-semibold text-[#3a5e94]",children:[o,"лв"]})]})]});return e.jsx("div",{className:"w-[90%] h-full flex items-center",children:e.jsxs(O,{modules:[I,z,B],slidesPerView:((r==null?void 0:r.width)??0)>768?2:1,slidesPerGroup:((r==null?void 0:r.width)??0)>768?2:1,navigation:!0,loop:!0,pagination:{clickable:!1},spaceBetween:32,children:[e.jsx(y,{children:e.jsx(s,{title:"Къса прическа",price:10,src:"/images/short_hair_square.jpg"})}),e.jsx(y,{children:e.jsx(s,{title:"Дълга прическа",price:15,src:"/images/design_studio_square.jpg"})}),e.jsx(y,{children:e.jsx(s,{title:"Услуга 1",price:5,src:"/images/short_hair_burst_fade_cropped.jpg"})}),e.jsx(y,{children:e.jsx(s,{title:"Услуга 2",price:12.5,src:"/images/short_hair_burst_fade_design_cropped.jpg"})})]})})};function ee({selectedDate:t,selectedHour:r,setSelectedHour:s,setSelectedService:a,dimensions:o}){return e.jsxs("div",{className:"w-full h-[95%] bg-white rounded-xl shadow-lg border border-gray-300 font-manrope",children:[e.jsxs("div",{className:"w-full h-[8%] bg-[#f8f8f8] rounded-x-xl rounded-t-xl border-b border-gray-300 flex flex-row items-center gap-x-6",children:[e.jsx("button",{className:`w-16 h-full border-r border-gray-300 mt-[-4px]
                    hover:opacity-40 transition-colors duration-200 cursor-pointer
                `,onClick:()=>{s("")},children:e.jsx("p",{className:"text-4xl text-[#4a6fa5]",children:"<"})}),e.jsxs("div",{className:"flex flex-row w-full md:w-1/2 h-full items-center gap-x-3",children:[e.jsx("p",{className:"text-sm 3xs:text-base md:text-2xl font-semibold text-[#403f3f] min-w-1/2 border-r border-gray-300",children:j(t)}),e.jsx("p",{className:"text-sm 3xs:text-base md:text-2xl font-semibold text-[#403f3f] min-w-1/2",children:r})]})]}),e.jsx("div",{className:"w-full h-[92%] flex justify-center",children:e.jsx(Z,{setSelectedService:a,dimensions:o})})]})}const te=async(t,r,s,a,o,n,d,u,c,h,m)=>{t||!s||!a||!o||!n||!d||!u||await E(u,d,n)!=!1&&(r(!0),await H(n,d,u,s,a,o,c,r,h,m),r(!1))};function re({selectedDate:t,selectedHour:r,selectedService:s,setSelectedService:a,loading:o,setLoading:n,navigate:d,isAdmin:u}){const[c,h]=x.useState({email:"",name:"",phone:"",additionalInfo:""}),m=g=>{const{name:i,value:l}=g.target;h({...c,[i]:l})},p=async g=>{g.preventDefault();const l=new Date(t.getTime()-t.getTimezoneOffset()*6e4).toISOString().split("T")[0];await te(o,n,s,l,r,c.name,c.phone,c.email,c.additionalInfo,d,u)};return e.jsxs("div",{className:"w-full h-[93%] bg-white rounded-xl shadow-lg border border-gray-300 font-manrope",children:[e.jsxs("div",{className:"w-full h-[8%] bg-[#f8f8f8] rounded-x-xl rounded-t-xl border-b border-gray-300 flex flex-row items-center gap-x-6",children:[e.jsx("button",{className:`w-16 h-full border-r border-gray-300 mt-[-4px]
                    hover:opacity-40 transition-colors duration-200 cursor-pointer
                `,onClick:()=>{a("")},children:e.jsx("p",{className:"text-4xl text-[#4a6fa5]",children:"<"})}),e.jsxs("div",{className:"flex flex-row w-full md:w-1/2 h-full items-center gap-x-3",children:[e.jsx("p",{className:"text-sm 3xs:text-base md:text-2xl font-semibold text-[#403f3f] min-w-1/2 border-r border-gray-300",children:j(t)}),e.jsx("p",{className:"text-sm 3xs:text-base md:text-2xl font-semibold text-[#403f3f] min-w-1/2",children:r})]})]}),e.jsxs("div",{className:"max-w-2xl mx-auto px-6 pt-[10%] md:py-6 md:px-6 h-[80%] flex flex-col items-center md:justify-center",children:[e.jsx("p",{className:"text-xl md:text-2xl font-semibold text-[#403f3f] w-full mb-3 text-center",children:s}),e.jsxs("form",{className:"grid grid-cols-1 gap-4 w-full",onSubmit:p,children:[e.jsx("input",{name:"email",placeholder:"Имейл",className:"w-full p-3 border border-gray-300 shadow-sm rounded-xl text-black",value:c.email,onChange:m,maxLength:40,required:!0}),e.jsx("input",{name:"name",placeholder:"Име",className:"w-full p-3 border border-gray-300 shadow-sm rounded-xl text-black",value:c.name,onChange:m,maxLength:30,required:!0}),e.jsx("input",{name:"phone",placeholder:"Телефонен номер",className:"w-full p-3 border border-gray-300 shadow-sm rounded-xl text-black",value:c.phone,onChange:m,maxLength:10,required:!0}),e.jsx("input",{name:"additionalInfo",placeholder:"Допълнителна информация",className:"w-full p-3 border border-gray-300 shadow-sm rounded-xl text-black",value:c.additionalInfo,maxLength:50,onChange:m}),e.jsx("button",{type:"submit",className:`bg-[#567bb1] text-white text-lg font-medium shadow-sm p-3 rounded-xl
                        
                        hover:opacity-80 transition-colors duration-200`,children:"Запиши ме"})]})]})]})}const se=async()=>{const t=localStorage.getItem("bookedDays");return t?JSON.parse(t):[]},oe=()=>{const t=_(),{loading:r,setLoading:s,isAdmin:a}=A(),[o,n]=x.useState(!1),[d,u]=x.useState(new Date),[c,h]=x.useState(""),[m,p]=x.useState(""),[g,i]=x.useState([]),[l,f]=x.useState([]),[b,k]=x.useState([]),[S,C]=x.useState({width:0,height:0}),D=async()=>{const w=await $();C(w)};return x.useEffect(()=>{const w=()=>{D()};return window.addEventListener("resize",w),D(),()=>{window.removeEventListener("resize",w)}},[]),x.useEffect(()=>{(async()=>{const M=await X();f(M);const F=await se();k(F)})()},[]),x.useEffect(()=>{o&&J(d,r,s,i,l)},[d]),e.jsx("div",{className:`w-full h-full font-manrope ${a?"px-10 pt-6":"px-[4%] md:px-[9%] pt-10"}`,children:o?o&&!c?e.jsx(Q,{selectedDate:d,setInitialDateSelected:n,availableHours:g,setSelectedHour:h}):m?e.jsx(re,{selectedDate:d,selectedHour:c,selectedService:m,setSelectedService:p,loading:r,setLoading:s,navigate:t,isAdmin:a}):e.jsx(ee,{selectedDate:d,selectedHour:c,setSelectedHour:h,setSelectedService:p,dimensions:S}):e.jsx(q,{selectedDate:d,setSelectedDate:u,setInitialDateSelected:n,navigate:t,bookedDays:b})})},ue=Y(oe);export{ue as default};
